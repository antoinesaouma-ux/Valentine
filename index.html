<!--
===========================================================
üíå Carte Valentine Interactive avec Chats Anim√©s üê±
-----------------------------------------------------------
- Fichier unique index.html (HTML + CSS + JS inline)
- Carte carr√©e centr√©e avec message romantique (style Cyrano)
- Boutons Oui / Non
- Les chats apparaissent UNIQUEMENT apr√®s 3 clics sur "Non"
- Chats anim√©s via sprite-sheet (ping-pong)
- Chats du milieu fuient la souris horizontalement
- Code enti√®rement comment√© et facilement modifiable

üëâ Modifications rapides :
- Sprite : modifier CAT_SRC
- Animation : FRAME_W / FRAME_H / TOTAL_FRAMES / FPS
- Comportement : FEAR_RADIUS / HOVER_THRESHOLD / vitesses
===========================================================
-->

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ma Valentine ‚ù§Ô∏è</title>

<style>
/* ===================== RESET & PAGE ===================== */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: 'Georgia', serif;
  background: linear-gradient(135deg, #ffe6eb, #fff);
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ===================== CARTE ===================== */
.card {
  width: min(90vmin, 420px);
  aspect-ratio: 1 / 1; /* ‚úÖ format carr√© */
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  text-align: center;
  padding: 24px;
  position: relative;
  overflow: hidden;
}

/* ===================== TEXTE ===================== */
.card p {
  margin: 10px 0;
  font-size: 1.15rem;
}

.card p:first-child {
  font-style: italic;
}

/* ===================== BOUTONS ===================== */
.buttons {
  margin-top: 20px;
}

button {
  padding: 10px 22px;
  margin: 0 10px;
  font-size: 1rem;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  background: #ff6b81;
  color: #fff;
}

button:focus {
  outline: 3px solid #000;
}

button.no {
  background: #aaa;
}

/* ===================== MESSAGE OUI ===================== */
.confirmation {
  font-size: 1.5rem;
  margin-top: 30px;
  color: #ff3366;
}

/* ===================== CHATS ===================== */
.cat {
  position: absolute;
  width: calc(var(--fw) * var(--scale));
  height: calc(var(--fh) * var(--scale));
  background-image: url('images/cat.png'); /* ‚ö†Ô∏è Chemin sprite ici */
  background-repeat: no-repeat;
  image-rendering: pixelated;
  pointer-events: auto;
}
</style>
</head>

<body>

<div class="card" id="card">
  <p>Je t‚Äôaime non pour ce que tu es, mais pour ce que je suis quand je suis avec toi.</p>
  <p><strong>Veux-tu √™tre ma Valentine ?</strong></p>

  <div class="buttons" id="buttons">
    <button id="yesBtn">Oui</button>
    <button id="noBtn" class="no">Non</button>
  </div>
</div>

<script>
/* =========================================================
   ======================= CONFIG ==========================
   ========================================================= */
const CAT_SRC = 'images/cat.png'; // ‚ö†Ô∏è sprite-sheet requise
const FRAME_W = 64;
const FRAME_H = 64;
const FRAMES_PER_ROW = 8;
const TOTAL_FRAMES = 16;
const FPS = 10;
const PINGPONG = true;
const CAT_SCALE = 1.5;

const FEAR_RADIUS = 160;
const WALK_SPEED = 1.1;
const FLEE_SPEED = 3.0;
const PANIC_SPEED = 4.0;

const HOVER_THRESHOLD = 3;
const HOVER_NO_SPAWN_THRESHOLD = 3; // ‚úÖ 3 clics sur "Non"

/* ========================================================= */

document.documentElement.style.setProperty('--fw', FRAME_W + 'px');
document.documentElement.style.setProperty('--fh', FRAME_H + 'px');
document.documentElement.style.setProperty('--scale', CAT_SCALE);

const card = document.getElementById('card');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const buttons = document.getElementById('buttons');

let noCount = 0;
let catsSpawned = false;
let mouseX = 0;

/* ===================== SOURIS ===================== */
window.addEventListener('mousemove', e => {
  mouseX = e.clientX;
});

/* ===================== OUI ===================== */
yesBtn.onclick = () => {
  buttons.remove();
  const msg = document.createElement('div');
  msg.className = 'confirmation';
  msg.textContent = 'Oui ! ‚ù§Ô∏è';
  card.appendChild(msg);
};

/* ===================== NON ===================== */
noBtn.onclick = () => {
  noCount++;
  if (noCount >= HOVER_NO_SPAWN_THRESHOLD && !catsSpawned) {
    spawnCats();
    catsSpawned = true;
  }
};

/* ===================== CHATS ===================== */
const cats = [];

function spawnCats() {
  const positions = ['20%', '50%', '80%'];

  positions.forEach((top, index) => {
    const cat = document.createElement('div');
    cat.className = 'cat';
    cat.style.top = top;
    cat.style.left = '20px';

    const obj = {
      el: cat,
      x: 20,
      y: 0,
      vx: WALK_SPEED,
      frame: 0,
      dir: 1,
      hover: 0,
      mobile: index === 1
    };

    cat.addEventListener('mouseenter', () => {
      obj.hover++;
      if (obj.hover >= HOVER_THRESHOLD) {
        obj.vx = PANIC_SPEED * obj.dir;
      }
    });

    card.appendChild(cat);
    cats.push(obj);
  });

  requestAnimationFrame(loop);
}

/* ===================== ANIMATION ===================== */
let last = 0;

function loop(ts) {
  if (ts - last > 1000 / FPS) {
    cats.forEach(c => {
      // Mouvement horizontal uniquement
      if (c.mobile) {
        const dist = Math.abs(mouseX - (card.offsetLeft + c.x));
        if (dist < FEAR_RADIUS) {
          c.vx = (mouseX < card.offsetLeft + c.x) ? FLEE_SPEED : -FLEE_SPEED;
        } else {
          c.vx = c.dir * WALK_SPEED;
        }
        c.x += c.vx;
      }

      // Ping-pong √©cran
      if (c.x < 0 || c.x > card.clientWidth - FRAME_W * CAT_SCALE) {
        c.dir *= -1;
        c.vx *= -1;
      }

      c.el.style.left = c.x + 'px';

      // Animation sprite
      c.frame += PINGPONG ? c.dir : 1;
      if (c.frame >= TOTAL_FRAMES || c.frame < 0) c.dir *= -1;

      const fx = (c.frame % FRAMES_PER_ROW) * FRAME_W;
      const fy = Math.floor(c.frame / FRAMES_PER_ROW) * FRAME_H;
      c.el.style.backgroundPosition = `-${fx}px -${fy}px`;

      // Orientation
      c.el.style.transform = c.vx < 0 ? 'scaleX(-1)' : 'scaleX(1)';
    });

    last = ts;
  }
  requestAnimationFrame(loop);
}

/* ===================== ERREUR SPRITE ===================== */
const img = new Image();
img.onerror = () => {
  console.error('‚ùå Sprite introuvable : images/cat.png');
};
img.src = CAT_SRC;
</script>

</body>
</html>
