<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Veux-tu √™tre ma Valentine ? üíï</title>
  <style>
    :root {
      /* üé® PALETTE MODERNE MATE */
      --card-width: min(90vw, 650px);
      --card-height: min(92vh, 850px);
      
      --bg-dark: #0a0e27;
      --bg-darker: #060817;
      --card-bg: linear-gradient(145deg, #1a1f3a 0%, #0f1429 100%);
      --card-shadow: 0 30px 80px rgba(0, 0, 0, 0.7), 0 0 1px rgba(184, 148, 82, 0.3);
      --text-color: #e8e6e3;
      --accent-gold: #b89452;
      --accent-gold-bright: #d4af37;
      --btn-yes-bg: linear-gradient(135deg, #b89452 0%, #8b6f3e 100%);
      --btn-yes-hover: linear-gradient(135deg, #d4af37 0%, #b89452 100%);
      --btn-no-bg: linear-gradient(135deg, #2d3456 0%, #1a1f3a 100%);
      --btn-no-hover: linear-gradient(135deg, #3d4566 0%, #2d3456 100%);
      --font-romantic: 'Georgia', 'Palatino', serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-romantic);
      background: radial-gradient(ellipse at top, var(--bg-dark) 0%, var(--bg-darker) 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* ‚≠ê √âTOILES UNIQUEMENT EN HAUT (30% de l'√©cran) */
    .pixel-stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 30vh;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .pixel-star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      box-shadow: 0 0 3px rgba(255, 255, 255, 0.4);
      animation: subtleTwinkle 3s ease-in-out infinite;
    }

    @keyframes subtleTwinkle {
      0%, 100% { 
        opacity: 0.3; 
        transform: scale(1);
      }
      50% { 
        opacity: 0.8; 
        transform: scale(1.4);
      }
    }

    /* üå† √âTOILE FILANTE */
    .shooting-star {
      position: fixed;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.8);
      pointer-events: none;
      z-index: 2;
      opacity: 0;
    }

    .shooting-star::after {
      content: '';
      position: absolute;
      top: 0;
      right: 2px;
      width: 80px;
      height: 1px;
      background: linear-gradient(90deg, 
        rgba(255,255,255,0.9) 0%, 
        rgba(255,255,255,0.4) 50%,
        transparent 100%);
    }

    @keyframes shoot {
      0% {
        opacity: 0;
        transform: translate(0, 0);
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        opacity: 0;
        transform: translate(-500px, 350px);
      }
    }

    .card {
      width: var(--card-width);
      height: var(--card-height);
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 2.5rem 2rem;
      text-align: center;
      position: relative;
      z-index: 10;
      border: 1px solid rgba(184, 148, 82, 0.2);
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 24px;
      padding: 1px;
      background: linear-gradient(135deg, 
        transparent 0%, 
        rgba(184, 148, 82, 0.3) 50%, 
        transparent 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      animation: borderGlow 4s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes borderGlow {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.8; }
    }

    .romantic-text {
      font-size: clamp(0.95rem, 2.2vmin, 1.25rem);
      line-height: 1.7;
      color: var(--text-color);
      font-style: normal;
      margin-bottom: 1rem;
      max-width: 100%;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      flex-shrink: 0;
    }

    .romantic-text p {
      margin-bottom: 0.8rem;
    }

    .romantic-text .question {
      font-weight: bold;
      font-size: clamp(1.4rem, 3.8vmin, 2.2rem);
      font-style: normal;
      margin-top: 1.5rem;
      color: var(--accent-gold-bright);
      text-shadow: 0 0 20px rgba(184, 148, 82, 0.4);
      animation: gentlePulse 3s ease-in-out infinite;
    }

    @keyframes gentlePulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.03); opacity: 0.95; }
    }

    .buttons {
      display: flex;
      gap: 2rem;
      margin: 1.5rem 0;
      flex-shrink: 0;
      transition: justify-content 0.6s ease;
    }

    button {
      padding: 1.1rem 2.8rem;
      font-size: clamp(1rem, 2.3vmin, 1.25rem);
      font-family: var(--font-romantic);
      font-weight: 600;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,0.15), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    button:hover::before {
      transform: translateX(100%);
    }

    button:focus {
      outline: 2px solid var(--accent-gold);
      outline-offset: 3px;
    }

    #btnYes {
      background: var(--btn-yes-bg);
    }

    #btnYes:hover {
      background: var(--btn-yes-hover);
      transform: scale(1.08) translateY(-2px);
      box-shadow: 0 10px 30px rgba(184, 148, 82, 0.4);
    }

    #btnNo {
      background: var(--btn-no-bg);
      transition: all 0.15s ease-out;
    }

    #btnNo:hover {
      background: var(--btn-no-hover);
    }

    #btnNo.fleeing {
      position: fixed;
      z-index: 9999;
    }

    .confirmation {
      display: none;
      font-size: clamp(1.2rem, 3vmin, 1.8rem);
      color: var(--accent-gold-bright);
      font-weight: bold;
      text-shadow: 0 0 15px rgba(184, 148, 82, 0.5);
      animation: heartbeat 2s infinite;
      line-height: 1.6;
      flex-shrink: 0;
      text-align: center;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    #teasingMessage {
      position: absolute;
      top: 1.2rem;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(45, 52, 86, 0.8);
      backdrop-filter: blur(10px);
      padding: 0.9rem 1.8rem;
      border-radius: 12px;
      font-size: clamp(0.85rem, 1.9vmin, 1.05rem);
      color: var(--accent-gold-bright);
      font-style: normal;
      display: none;
      max-width: 85%;
      text-align: center;
      border: 1px solid rgba(184, 148, 82, 0.3);
      animation: slideDown 0.4s ease-out;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      z-index: 15;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-15px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    #noCounter {
      position: absolute;
      bottom: 1.2rem;
      right: 1.2rem;
      background: rgba(45, 52, 86, 0.8);
      backdrop-filter: blur(10px);
      padding: 0.6rem 1rem;
      border-radius: 10px;
      font-size: 0.85rem;
      color: var(--accent-gold);
      display: none;
      border: 1px solid rgba(184, 148, 82, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    }

/* ‚úÖ GIF CENTR√â ET R√âDUIT */
.gif-container {
  display: none;
  margin: 1.5rem auto 0; /* ‚úÖ SYNTAXE CORRECTE */
  animation: fadeIn 0.6s ease-in;
  width: 100%;
  max-width: 320px; /* ‚úÖ Un peu plus grand */
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
  border: 2px solid rgba(184, 148, 82, 0.3);
  overflow: hidden;
}


    .gif-container img {
      width: 100%;
      height: auto; /* ‚úÖ CORRECTION CL√âE : hauteur automatique */
      display: block;
      border-radius: 14px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9) translateY(15px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .cat {
      position: fixed;
      background-image: url('image/cat.png');
      background-repeat: no-repeat;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
      pointer-events: auto;
      z-index: 5;
      will-change: transform, left;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.6));
    }

    .cat.face-left {
      transform: scaleX(-1) translateZ(0);
    }

    .cat.face-right {
      transform: scaleX(1) translateZ(0);
    }
  </style>
</head>
<body>

  <!-- ‚≠ê CIEL √âTOIL√â (HAUT UNIQUEMENT) -->
  <div class="pixel-stars" id="pixelStars"></div>

  <!-- üå† √âTOILE FILANTE -->
  <div class="shooting-star" id="shootingStar"></div>

  <div class="card" id="card">
    <div class="romantic-text">
      <p>
        Rassure-toi mon petit c≈ìur, comme la premi√®re ann√©e, et pour toutes celles √† venir,<br>
        je te le demanderai encore et encore,
      </p>
      <p class="question">
        Veux‚Äëtu √™tre ma Valentine ? üíï
      </p>
    </div>

    <div class="buttons" id="buttons">
      <button id="btnYes">Oui ‚ù§Ô∏è</button>
      <button id="btnNo">Non</button>
    </div>

    <div class="confirmation" id="confirmation">
      Eheh ! ‚ù§Ô∏è‚ú® <br>
      Je n'ai jamais dout√©  ;))
      <div class="gif-container" id="gifContainer">
        <img src="image/love-mochi.gif" alt="Love GIF" />
      </div>
    </div>

    <div id="teasingMessage"></div>
    <div id="noCounter"></div>
  </div>

  <script>
    'use strict';

    const CONFIG = {
      CAT_SRC: 'image/cat.png',
      FRAME_W: 32,
      FRAME_H: 32,
      FRAMES_PER_ROW: 8,
      TOTAL_ROWS: 8,
      
      IDLE_ROWS: [0, 1, 2, 3],
      WALK_ROWS: [4, 5],
      
      FPS: 8,
      FPS_IDLE: 3,

      CAT_SCALE: 3.5,

      FEAR_RADIUS: 100,
      FLEE_SPEED: 4.5,
      WALK_SPEED: 1.8,
      PANIC_SPEED: 5.5,

      OFFSCREEN_MARGIN: 250,
      HOVER_THRESHOLD: 3,
      NO_CLICKS_TO_SPAWN: 3,

      BTN_FLEE_RADIUS: 250,
      BTN_FLEE_SPEED: 15,
      BTN_TAQUIN_MODE: true,

      STAR_COUNT: 60,
      SHOOTING_STAR_INTERVAL: 12000,

      NO_CLICKS_TO_HIDE: 11, // ‚úÖ AJOUT√â
      YES_MAGNET_SPEED: 0.04, // ‚úÖ AJOUT√â
      YES_MAX_OFFSET: 40,
    };

    const TEASING_PHRASES = [
      "Oh... vraiment ? ü•∫",
      "Tu es s√ªre ? Je suis adorable pourtant ! ^^",
      "Allez, regarde ces petits chats... üê±",
      "Certains chats ont peur des souris‚Ä¶ tu avais devin√© ?",
      "est ce que tu te rend compte tu temps <br> que j'ai pass√© sur ces chats pour qu'ils ne te conviennent pas ?",
      "Tu sais qu'a chaque fois que tu dis non un petit gar√ßon a le coeur bris√© ? ",
      "Tu me brises le c≈ìur l√†... üíî ",
      "Les chats sont d√©√ßus de toi... üòø",
      "C'est ton dernier mot ? ü§®",
      "Bon... tan pis je vais t'aider a te d√©cider ! üòà",
      "Non mais je pense que tu as des probl√®mes de vue... je t'aide un peu üëÄ‚ú®" 
    ];

    let cats = [];
    let mouseX = -9999, mouseY = -9999;
    let animationFrameId = null;
    let noClickCount = 0;
    let catsSpawned = false;
    let btnNoFleeing = false;
    let magnetActive = false; // ‚úÖ AJOUT√â NEWS

    const btnYes = document.getElementById('btnYes');
    const btnNo = document.getElementById('btnNo');
    const buttons = document.getElementById('buttons');
    const confirmation = document.getElementById('confirmation');
    const noCounter = document.getElementById('noCounter');
    const teasingMessage = document.getElementById('teasingMessage');

    function createStars() {
      const container = document.getElementById('pixelStars');
      
      for (let i = 0; i < CONFIG.STAR_COUNT; i++) {
        const star = document.createElement('div');
        star.className = 'pixel-star';
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 3}s`;
        star.style.animationDuration = `${2 + Math.random() * 2}s`;
        container.appendChild(star);
      }
    }

    function createShootingStar() {
      const star = document.getElementById('shootingStar');
      
      setInterval(() => {
        star.style.left = `${Math.random() * 40 + 60}%`;
        star.style.top = `${Math.random() * 15 + 5}vh`;
        star.style.animation = 'none';
        
        setTimeout(() => {
          star.style.animation = 'shoot 1.5s ease-out';
        }, 10);
      }, CONFIG.SHOOTING_STAR_INTERVAL);
    }

    function init() {
      createStars();
      createShootingStar();

      const img = new Image();
      img.src = CONFIG.CAT_SRC;
      img.onload = () => {
        console.log(`‚úÖ Sprite charg√©e : ${CONFIG.CAT_SRC}`);
      };
      img.onerror = () => {
        console.error(`‚ùå ERREUR : sprite introuvable ‚Üí ${CONFIG.CAT_SRC}`);
        alert(`‚ö†Ô∏è Place ton fichier cat.png dans le dossier image/`);
      };

 btnYes.addEventListener('click', () => {
  buttons.style.display = 'none';
  confirmation.style.display = 'block';
  noCounter.style.display = 'none';
  teasingMessage.style.display = 'none';
  
  document.getElementById('gifContainer').style.display = 'block'; // ‚úÖ IMM√âDIAT

        
        if (animationFrameId) cancelAnimationFrame(animationFrameId);
        cats.forEach(cat => cat.el.remove());
        cats = [];
        btnNoFleeing = false;
      });

      btnNo.addEventListener('click', handleNoClick);

      document.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
      });

      startFleeingLoop();
    }

function handleNoClick() {
  noClickCount++;
  
  const phraseIndex = Math.min(noClickCount - 1, TEASING_PHRASES.length - 1);
  teasingMessage.innerHTML = TEASING_PHRASES[phraseIndex];
  teasingMessage.style.display = 'block';
  
  noCounter.textContent = `"Non" √ó ${noClickCount}`;
  noCounter.style.display = 'block';

  if (noClickCount >= CONFIG.NO_CLICKS_TO_SPAWN && !catsSpawned) {
    catsSpawned = true;
    console.log(`üê± Spawn des chats apr√®s ${CONFIG.NO_CLICKS_TO_SPAWN} clics !`);
    spawnCats();
    startAnimation();
  }

  // ‚úÖ MODIFI√â : Au 11√®me clic
  if (noClickCount === CONFIG.NO_CLICKS_TO_HIDE) {
    console.log('üö´ Bouton "Non" cach√© au clic 11 !');
    
    // Cacher le bouton "Non"
    btnNo.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    btnNo.style.opacity = '0';
    btnNo.style.transform = 'scale(0)';
    btnNo.style.pointerEvents = 'none';
    
    // Agrandir le bouton "Oui" (+30%)
    const rect = btnYes.getBoundingClientRect();

    btnYes.style.position = 'fixed';
    btnYes.style.left = `${rect.left}px`;
    btnYes.style.top = `${rect.top}px`;
    btnYes.style.margin = '0';
    btnYes.style.transform = 'scale(1.35)';
    btnYes.style.zIndex = '9999';
    
    btnYes.dataset.x = rect.left;
    btnYes.dataset.y = rect.top;
    
    magnetActive = true;
    
        
    // Centrer le bouton "Oui"
    buttons.style.justifyContent = 'center';
    
    // Activer l'aimant
    magnetActive = true;
    console.log('üß≤ Aimant activ√© !');
    
  } else if (noClickCount < CONFIG.NO_CLICKS_TO_HIDE && noClickCount >= TEASING_PHRASES.length - 1) {
    activateFleeingButton();
  }
}


    function activateFleeingButton() {
      btnNoFleeing = true;
      btnNo.classList.add('fleeing');
      btnNo.style.position = 'fixed';
      btnNo.style.zIndex = '9999';
      
      const rect = btnNo.getBoundingClientRect();
      btnNo.style.left = `${rect.left}px`;
      btnNo.style.top = `${rect.top}px`;
      btnNo.style.transform = 'none';
      
      console.log('üèÉ Bouton "Non" en mode fuite TAQUIN !');
    }

    function startFleeingLoop() {
      function loop() {
        if (btnNoFleeing) {
          const rect = btnNo.getBoundingClientRect();
          const btnCenterX = rect.left + rect.width / 2;
          const btnCenterY = rect.top + rect.height / 2;
          
          const distX = mouseX - btnCenterX;
          const distY = mouseY - btnCenterY;
          const dist = Math.sqrt(distX * distX + distY * distY);
          
          if (dist < CONFIG.BTN_FLEE_RADIUS) {
            let speed = CONFIG.BTN_FLEE_SPEED;
            
            if (CONFIG.BTN_TAQUIN_MODE) {
              const intensity = 1 - (dist / CONFIG.BTN_FLEE_RADIUS);
              speed = CONFIG.BTN_FLEE_SPEED * (1 + intensity * 2);
            }
            
            const angle = Math.atan2(distY, distX);
            const fleeX = -Math.cos(angle) * speed;
            const fleeY = -Math.sin(angle) * speed;
            
            let newX = rect.left + fleeX;
            let newY = rect.top + fleeY;
            
            const maxX = window.innerWidth - rect.width;
            const maxY = window.innerHeight - rect.height;
            
            newX = Math.max(0, Math.min(newX, maxX));
            newY = Math.max(0, Math.min(newY, maxY));
            
            if ((newX === 0 || newX === maxX) && (newY === 0 || newY === maxY)) {
              newX = Math.random() * maxX;
              newY = Math.random() * maxY;
              console.log('üìç Bouton t√©l√©port√© !');
            }
            
            btnNo.style.left = `${newX}px`;
            btnNo.style.top = `${newY}px`;
          }
        }
        requestAnimationFrame(loop);
      }
      loop();
    }
// üß≤ EFFET AIMANT : Le bouton "Oui" suit la souris
function attractYesButton() {
  if (!magnetActive) {
    requestAnimationFrame(attractYesButton);
    return;
  }

  const rect = btnYes.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;

  const dx = mouseX - centerX;
  const dy = mouseY - centerY;

  const max = CONFIG.YES_MAX_OFFSET;

  const targetX = rect.left + Math.max(-max, Math.min(dx, max));
  const targetY = rect.top + Math.max(-max, Math.min(dy, max));

  const currentX = parseFloat(btnYes.dataset.x);
  const currentY = parseFloat(btnYes.dataset.y);

  const lerp = CONFIG.YES_MAGNET_SPEED;

  const nextX = currentX + (targetX - currentX) * lerp;
  const nextY = currentY + (targetY - currentY) * lerp;

  btnYes.dataset.x = nextX;
  btnYes.dataset.y = nextY;

  btnYes.style.left = `${nextX}px`;
  btnYes.style.top = `${nextY}px`;
  btnYes.style.transform = 'scale(1.35)';

  requestAnimationFrame(attractYesButton);
}

attractYesButton(); // ‚úÖ D√©marre la boucle

    function spawnCats() {
      const screenW = window.innerWidth;
      const screenH = window.innerHeight;

      const yTop = screenH * 0.2;
      const yMid = screenH * 0.5;
      const yBot = screenH * 0.8;

      cats.push(createCat(screenW * 0.15, yTop, 'fixed', 'right', 0));
      cats.push(createCat(screenW * 0.85, yTop, 'fixed', 'left', 1));
      cats.push(createCat(screenW * 0.25, yBot, 'fixed', 'right', 2));
      cats.push(createCat(screenW * 0.75, yBot, 'fixed', 'left', 3));

      cats.push(createCat(screenW * 0.3, yMid, 'mobile', 'right', 4));
      cats.push(createCat(screenW * 0.7, yMid, 'mobile', 'left', 5));
    }

    function createCat(x, y, type, facing, rowIndex) {
      const el = document.createElement('div');
      el.className = 'cat';
      
      const displayW = CONFIG.FRAME_W * CONFIG.CAT_SCALE;
      const displayH = CONFIG.FRAME_H * CONFIG.CAT_SCALE;
      
      el.style.width = `${displayW}px`;
      el.style.height = `${displayH}px`;
      el.style.backgroundSize = `${CONFIG.FRAMES_PER_ROW * displayW}px auto`;
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
      document.body.appendChild(el);

      const cat = {
        el,
        x, y,
        vx: 0,
        type,
        facing,
        rowIndex,
        frame: 0,
        frameTimer: 0,
        direction: 1,
        hoverCount: 0,
        leaving: false,
        markedForRemoval: false,
      };

      if (type === 'mobile') {
        cat.vx = (facing === 'right') ? CONFIG.WALK_SPEED : -CONFIG.WALK_SPEED;
      }

      el.addEventListener('mouseenter', () => {
        if (cat.type === 'mobile' && !cat.leaving) {
          cat.hoverCount++;
          console.log(`üê± Survol ${cat.hoverCount}/${CONFIG.HOVER_THRESHOLD}`);
          if (cat.hoverCount >= CONFIG.HOVER_THRESHOLD) {
            cat.leaving = true;
            console.log('üê± Chat part !');
            cat.vx = (cat.x < window.innerWidth / 2) ? -CONFIG.PANIC_SPEED : CONFIG.PANIC_SPEED;
            cat.facing = (cat.vx > 0) ? 'right' : 'left';
            setFacing(cat);
          }
        }
      });

      setFacing(cat);
      applyFrame(cat);

      return cat;
    }

    function startAnimation() {
      const frameDelay = 1000 / CONFIG.FPS;
      const idleFrameDelay = 1000 / CONFIG.FPS_IDLE;
      let lastTime = performance.now();

      function loop(currentTime) {
        const deltaTime = currentTime - lastTime;

        cats.forEach(cat => {
          if (cat.markedForRemoval) return;

          if (cat.type === 'fixed') {
            cat.frameTimer += deltaTime;
            if (cat.frameTimer >= idleFrameDelay) {
              cat.frameTimer -= idleFrameDelay;
              cat.frame = (cat.frame + 1) % 4;
              applyFrame(cat);
            }
          } else if (cat.leaving) {
            cat.x += cat.vx;
            const margin = CONFIG.OFFSCREEN_MARGIN;
            if (cat.x < -margin || cat.x > window.innerWidth + margin) {
              cat.markedForRemoval = true;
              cat.el.remove();
              console.log('üê± Chat supprim√©');
              return;
            }
          } else {
            const distX = Math.abs(mouseX - cat.x);
            if (distX < CONFIG.FEAR_RADIUS) {
              const flee = (cat.x < mouseX) ? -CONFIG.FLEE_SPEED : CONFIG.FLEE_SPEED;
              cat.vx = flee;
              cat.facing = (flee > 0) ? 'right' : 'left';
              setFacing(cat);
              cat.x += cat.vx;
            } else {
              cat.x += cat.vx;
              const catW = CONFIG.FRAME_W * CONFIG.CAT_SCALE;
              if (cat.x <= 0) {
                cat.x = 0;
                cat.vx = CONFIG.WALK_SPEED;
                cat.facing = 'right';
                setFacing(cat);
              } else if (cat.x >= window.innerWidth - catW) {
                cat.x = window.innerWidth - catW;
                cat.vx = -CONFIG.WALK_SPEED;
                cat.facing = 'left';
                setFacing(cat);
              }
            }
          }

          cat.el.style.left = `${cat.x}px`;

          if (cat.type === 'mobile') {
            cat.frameTimer += deltaTime;
            if (cat.frameTimer >= frameDelay) {
              cat.frameTimer -= frameDelay;
              cat.frame = (cat.frame + 1) % CONFIG.FRAMES_PER_ROW;
              applyFrame(cat);
            }
          }
        });

        cats = cats.filter(c => !c.markedForRemoval);
        lastTime = currentTime;
        animationFrameId = requestAnimationFrame(loop);
      }

      animationFrameId = requestAnimationFrame(loop);
    }

    function applyFrame(cat) {
      const displayW = CONFIG.FRAME_W * CONFIG.CAT_SCALE;
      const displayH = CONFIG.FRAME_H * CONFIG.CAT_SCALE;
      
      const offsetX = -cat.frame * displayW;
      const offsetY = -cat.rowIndex * displayH;
      
      cat.el.style.backgroundPosition = `${offsetX}px ${offsetY}px`;
    }

    function setFacing(cat) {
      if (cat.facing === 'left') {
        cat.el.classList.add('face-left');
        cat.el.classList.remove('face-right');
      } else {
        cat.el.classList.add('face-right');
        cat.el.classList.remove('face-left');
      }
    }

    init();
  </script>

</body>
</html>
