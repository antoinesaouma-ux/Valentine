<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pour toi üíò</title>
  <style>
    :root{
      --bg: #0f1020;
      --card-bg: linear-gradient(180deg,#161626 0%, #0f1120 100%);
      --text: #ecebf6;
      --muted: #9b9bb3;
      --accent: #ff6fa3;
      --cat-scale: 2;
      --frames-per-row: 8;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,Helvetica;display:flex;align-items:center;justify-content:center;}
    .container{
      width:min(820px,92vw);
      padding:36px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      width:100%;
      max-width:720px;
      background:var(--card-bg);
      border-radius:16px;
      padding:28px;
      box-shadow: 0 8px 30px rgba(3,6,23,0.6);
      position:relative;
      overflow:visible;
      text-align:center; /* centre le texte */
    }
    h1{margin:0 0 12px 0;font-size:22px}
    p.lead{margin:0 0 18px;color:var(--muted)}

    .actions{display:flex;gap:12px;align-items:center;margin-top:18px;justify-content:center;} /* centre les boutons */
    button.btn{
      background:transparent;
      color:var(--text);
      border:1px solid rgba(255,255,255,0.06);
      padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;
      min-width:88px;
      transition: transform 160ms ease, opacity 160ms ease;
    }
    button.btn.yes{background:linear-gradient(90deg,var(--accent),#ff8fb3);color:#0b0720;border:none}
    button.btn:disabled{opacity:0.6;cursor:default}

    /* petits vers amoureux */
    .vers{
      margin-top:14px;
      font-style:italic;
      color:#ffd7e6;
      opacity:0.95;
    }

    /* toast simple */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:28px;
      background:rgba(0,0,0,0.45);
      color:var(--text);
      padding:10px 16px;border-radius:10px;font-weight:600;backdrop-filter: blur(4px);
      opacity:0;transition:opacity 220ms ease;pointer-events:none;z-index:1100;
    }
    .toast.show{opacity:1;pointer-events:auto}

    /* GIF de c√©l√©bration (appara√Æt au-dessus du card) */
    .gif-wrap{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      pointer-events:auto;
      z-index:99999;
      top: -8px; /* sera recalcul√© si n√©cessaire */
      display:flex;
      align-items:flex-start;
      gap:8px;
      pointer-events: none; /* l'image seule g√®re le click */
    }
    .celebration-gif{
      width:180px;
      max-width:48vw;
      opacity:0;
      transition: opacity 260ms ease, transform 260ms ease;
      transform:translateY(-8px);
      filter: drop-shadow(0 10px 28px rgba(0,0,0,0.45));
      pointer-events:auto;
      border-radius:10px;
      display:block;
    }
    .celebration-gif.show{opacity:1;transform:translateY(0)}
    .gif-close{
      background:rgba(0,0,0,0.45);
      color:var(--text);
      border-radius:8px;
      padding:6px 8px;
      font-weight:700;
      cursor:pointer;
      pointer-events:auto;
      align-self:flex-start;
      margin-top:6px;
    }

    /* stage plein √©cran pour les chats */
    .stage{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:50;
      overflow:visible;
    }
    .cat{
      position:absolute;
      width:32px;
      height:32px;
      background-image:url("image/cat.png");
      background-repeat:no-repeat;
      image-rendering: pixelated;
      will-change: transform, background-position;
      transform-origin: left top;
      pointer-events:none;
    }

    @media (max-width:420px){
      .celebration-gif{width:140px}
      .gif-close{padding:5px 7px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="card">
      <h1>Veux-tu √™tre ma Valentine ? üíå</h1>
      <p class="lead">J'ai pr√©par√© une petite surprise ‚Äî d√©place la souris pour voir les chats. Choisis bien ‚ù§Ô∏è</p>

      <div class="actions">
        <button class="btn yes" id="yesBtn">Oui</button>
        <button class="btn no" id="noBtn">Non</button>
      </div>

      <div class="vers" id="vers">
        ¬´ Que vos modestes soupirs en soient les t√©moins, 
        et que mes vers, timides, rapprochent nos mains. ¬ª
      </div>

      <!-- zone o√π on positionne le GIF (absolue par rapport √† la card) -->
      <div id="gifArea"></div>
    </div>
  </div>

  <div class="stage" id="stage" aria-hidden="true"></div>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    /* Configuration */
    const SHEET_SRC = 'image/cat.png';
    const GIF_SRC = 'image/love-mochi.gif';
    const CSS_CAT_SCALE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cat-scale')) || 4;
    const FRAMES_PER_ROW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--frames-per-row')) || 8;

    /* UI */
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const toastEl = document.getElementById('toast');
    const stage = document.getElementById('stage');
    const card = document.getElementById('card');
    const gifArea = document.getElementById('gifArea');
    const versEl = document.getElementById('vers');

    function showToast(text, ms = 1500){
      toastEl.textContent = text;
      toastEl.classList.add('show');
      clearTimeout(toastEl._t);
      toastEl._t = setTimeout(()=> toastEl.classList.remove('show'), ms);
    }

    /* Sprite auto-detect */
    let SHEET_NAT_W=0, SHEET_NAT_H=0, FRAME_W=32, FRAME_H=32, SHEET_ROWS=1;
    function initSprite(){
      return new Promise((resolve,reject)=>{
        const img=new Image();
        img.src = SHEET_SRC + '?_=' + Date.now();
        img.onload = () => {
          SHEET_NAT_W = img.naturalWidth;
          SHEET_NAT_H = img.naturalHeight;
          FRAME_W = Math.round(SHEET_NAT_W / FRAMES_PER_ROW) || 32;
          FRAME_H = FRAME_W;
          SHEET_ROWS = Math.max(1, Math.round(SHEET_NAT_H / FRAME_H));
          console.info('sprite loaded', {SHEET_NAT_W,SHEET_NAT_H,FRAME_W,FRAME_H,FRAMES_PER_ROW,SHEET_ROWS});
          resolve();
        };
        img.onerror = ()=> reject(new Error('Impossible de charger ' + SHEET_SRC));
      });
    }

    /* Cr√©ation et animation des chats */
    let cats = [];
    function createCat({x=100,y=200,frames=4,row=0,speed=140} = {}){
      const el = document.createElement('div');
      el.className = 'cat';
      const SCALE = CSS_CAT_SCALE;
      const w = FRAME_W * SCALE;
      const h = FRAME_H * SCALE;
      el.style.width = w + 'px';
      el.style.height = h + 'px';
      el.style.backgroundSize = `${SHEET_NAT_W * SCALE}px ${SHEET_NAT_H * SCALE}px`;
      el._frameIndex = 0;
      el._frames = frames;
      el._row = row;
      el._speed = speed;
      el._last = performance.now();
      el._x = x; el._y = y;
      el.style.transform = `translate(${x}px, ${y}px) scale(${SCALE})`;
      const tick = (now) => {
        if (now - el._last >= el._speed){
          el._frameIndex = (el._frameIndex + 1) % el._frames;
          el._last = now;
          const bx = -(el._frameIndex * FRAME_W * SCALE);
          const by = -(el._row * FRAME_H * SCALE);
          el.style.backgroundPosition = `${bx}px ${by}px`;
        }
        el._raf = requestAnimationFrame(tick);
      };
      el._raf = requestAnimationFrame(tick);
      stage.appendChild(el);
      el.destroy = ()=>{ cancelAnimationFrame(el._raf); el.remove(); };
      cats.push(el);
      return el;
    }

    /* Fuite √† la souris */
    let mouseX = window.innerWidth/2;
    window.addEventListener('mousemove', (e)=>{
      mouseX = e.clientX;
      cats.forEach(c=>{
        const rect = c.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const dist = Math.abs(cx - mouseX);
        if (dist < 140){
          const dir = cx > mouseX ? 1 : -1;
          const delta = dir * Math.max(6, Math.round((140 - dist) / 8));
          c._x += delta;
          c._x = Math.max(0, Math.min(window.innerWidth - rect.width, c._x));
          c.style.transform = `translate(${c._x}px, ${c._y}px) scale(${CSS_CAT_SCALE})`;
        }
      });
    });

    /* spawn once utility */
    let spawned = false;
    function spawnCatsOnce(n=6){
      if (spawned) return;
      spawned = true;
      const baseY = Math.max(120, window.innerHeight - (FRAME_H * CSS_CAT_SCALE) - 140);
      for (let i=0;i<n;i++){
        const x = 30 + Math.floor(Math.random() * Math.max(120, window.innerWidth - 200));
        const y = baseY - Math.floor(Math.random() * 28);
        const row = Math.floor(Math.random()*SHEET_ROWS);
        createCat({x,y,frames:4,row,speed:120 + Math.round(Math.random()*90)});
      }
    }

    /* comportement du bouton NON avec 3 clicks */
    let noClicks = 0;
    const noMessages = [
      "Je pense que tu as d√ª te tromper‚Ä¶ r√©essaie ‚ù§Ô∏è",
      "Non, non ‚Äî c'est pas tr√®s gentil ! Essaie encore üòâ",
      "H√© ! Tu m'as forc√©¬∑e‚Ä¶ voil√† des chats ! üê±" // 3√®me -> spawn
    ];
    noBtn.addEventListener('click', (e)=>{
      noClicks++;
      if (noClicks <= 2){
        // messages taquins et r√©tr√©cissement progressif
        showToast(noMessages[noClicks-1], 1200);
        const shrink = 1 - 0.12*noClicks;
        noBtn.style.transform = `scale(${shrink})`;
      } else {
        // 3√®me click: spawn cats, disparition du bouton NO
        showToast(noMessages[2], 1400);
        noBtn.style.transform = `scale(0.5)`;
        noBtn.style.opacity = '0';
        noBtn.style.pointerEvents = 'none';
        setTimeout(()=> noBtn.remove(), 400);
        spawnCatsOnce(6);
      }
    });

    /* Oui : affiche GIF au dessus du card et le laisse visible jusqu'√† fermeture
       le gif peut √™tre ferm√© manuellement (croix) ou dispara√Æt apr√®s 6s (optionnel) */
    yesBtn.addEventListener('click', ()=>{
      showToast("Oui ! üíû", 1200);
      yesBtn.disabled = true;

      // wrapper absolu relatif √† la card
      const wrap = document.createElement('div');
      wrap.className = 'gif-wrap';
      // image
      const img = document.createElement('img');
      img.src = GIF_SRC;
      img.alt = 'Celebrate';
      img.className = 'celebration-gif';
      // close btn
      const close = document.createElement('button');
      close.className = 'gif-close';
      close.textContent = 'X';
      // enable pointer events in wrap
      wrap.style.pointerEvents = 'auto';

      wrap.appendChild(img);
      wrap.appendChild(close);
      // append to card so it's positioned above it
      card.appendChild(wrap);

      // ensure layout then position (center)
      requestAnimationFrame(()=>{
        // reposition if needed (already centered via CSS translateX(-50%))
        img.classList.add('show');
      });

      // close handlers
      function removeGif(){
        img.classList.remove('show');
        setTimeout(()=> { wrap.remove(); yesBtn.disabled = false; }, 260);
      }
      close.addEventListener('click', removeGif);
      img.addEventListener('click', removeGif);

      // auto remove after 6s (si tu pr√©f√®res pas, augmente/d√©sactive)
      wrap._timer = setTimeout(removeGif, 6000);
    });

    /* init */
    (async function init(){
      try {
        await initSprite();
      } catch(e){
        console.warn(e);
        showToast("Erreur: impossible de charger la sprite (voir console).", 2200);
      } finally {
        // on ne spawn plus automatiquement: les chats apparaissent au 3√®me "Non"
      }
    })();

    /* nettoyage */
    window.addEventListener('beforeunload', ()=>{
      cats.forEach(c=> c.destroy && c.destroy());
    });
  </script>
</body>
</html>
