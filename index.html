
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veux-tu Ãªtre ma Valentine ? ðŸ’Œ</title>
  <style>
    :root{
      --card-size: min(520px, 86vw);
      --bg: #0f1020;
      --card-bg: linear-gradient(180deg,#161626 0%, #0f1120 100%);
      --accent: #ff6fa3;
      --glass: rgba(255,255,255,0.03);
      --text: #ecebf6;
      --muted: #bfc0d9;

  /* Ã‰chelle des chats (scale entier) */
  --cat-scale: 4;
  --frame-w: 32; /* largeur d'une frame en px (non multipliÃ©e) */
  --frame-h: 32; /* hauteur d'une frame en px */
  --frames-per-row: 8;
  --sheet-rows: 8; /* nombre total de lignes (rows) dans la sprite sheet */
}

html,body{height:100%;margin:0;background:var(--bg);font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--text); display:flex; align-items:center; justify-content:center;}
.stage{position:relative; width:100%; height:100vh; overflow:hidden; display:flex; align-items:center; justify-content:center; padding:24px;}
.card {
  width: var(--card-size);
  height: var(--card-size);
  background: var(--card-bg);
  border-radius: 18px;
  box-shadow: 0 14px 40px rgba(2,6,23,0.6);
  border: 1px solid rgba(255,255,255,0.04);
  padding: 28px;
  box-sizing: border-box;
  display:flex;
  flex-direction:column;
  gap:14px;
  align-items:center;
  justify-content:center;
  text-align:center;
  position:relative;
  z-index: 10;
}
.lines { font-size:15px; color:var(--muted); line-height:1.35; max-width:86%; }
.lines .l1{ font-weight:600; color:var(--text); font-size:17px; }
h1 { margin: 6px 0 0 0; font-size:20px; letter-spacing:0.2px; }
.controls { margin-top:12px; display:flex; gap:12px; align-items:center; }
.btn {
  padding: 12px 18px;
  border-radius: 12px;
  border: none;
  cursor:pointer;
  font-weight:700;
  background:var(--glass);
  color:var(--text);
  min-width:96px;
  transition: transform 220ms cubic-bezier(.2,.9,.3,1), opacity 220ms;
  position:relative;
}
.btn.primary { background: linear-gradient(90deg,#ffd1e6, #ff9cc9); color:#3b0622; box-shadow: 0 8px 20px rgba(255,110,170,0.12); }
.btn.secondary { background: transparent; border: 1px solid rgba(255,255,255,0.06); color:var(--text); }
.toast { position:absolute; bottom:16px; left:50%; transform:translateX(-50%); color:var(--muted); font-size:13px; opacity:0; transition:opacity 220ms, transform 220ms; pointer-events:none; }
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
.note { position:absolute; left:18px; bottom:18px; color: rgba(255,255,255,0.16); font-size:12px; z-index:9; }

/* --- Pixel cats scaled proprement --- */
.cat{
  position:absolute;
  width: calc(var(--frame-w) * var(--cat-scale) * 1px);
  height: calc(var(--frame-h) * var(--cat-scale) * 1px);
  background-image: url("image/cat.png"); /* <-- adapte le chemin si besoin */
  background-repeat: no-repeat;
  image-rendering: pixelated;
  pointer-events:none;
  transform-origin: center;
  will-change: left, top, background-position, transform;
  z-index: 8;
}

@media (max-width:420px){
  .card{ padding:18px; border-radius:12px; }
  h1{ font-size:18px; }
}
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="card" role="dialog" aria-label="Question">
      <div class="lines">
        <div class="l1">Depuis que tu es entrÃ©e dans ma vie, chaque instant a retrouvÃ© du goÃ»t.</div>
        <div>Ton rire chasse mon ciel le plus gris, et ton regard m'apprend le courage.</div>
      </div>

  <h1>Veuxâ€‘tu Ãªtre ma Valentine ? ðŸ’˜</h1>

  <div class="controls" id="controls">
    <button id="yesBtn" class="btn primary">Oui ðŸ’–</button>
    <button id="noBtn" class="btn secondary">Non</button>
  </div>

  <div class="toast" id="toast">Oh vraiment ?</div>
</div>

<div class="note">Astuce : bouge la souris pour voir les chats rÃ©agir (aprÃ¨s le 3áµ‰ "Non").</div>
  </div>

  <script>
    /* ========== RÃ‰GLAGES ========== */
    const FRAME_W = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--frame-w')) || 32;
    const FRAME_H = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--frame-h')) || 32;
    const FRAMES_PER_ROW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--frames-per-row')) || 8;
    const SHEET_ROWS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sheet-rows')) || 8;
    const CAT_SCALE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cat-scale')) || 4;

    // Animations (row indices start at 0)
    const animations = {
      idle: { row: 7, frames: 4, speed: 500, move: 0 },
      walk: { row: 4, frames: FRAMES_PER_ROW, speed: 120, move: 1.2 },
      run:  { row: 5, frames: FRAMES_PER_ROW, speed: 80,  move: 3.0 }
    };

    const clamp = (v,a,b) => Math.max(a, Math.min(b, v));

    let mouseX = window.innerWidth / 2;

    // Update global mouseX (only horizontal)
    window.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
    });

    function createCat(opts = {}) {
      const cat = document.createElement('div');
      cat.className = 'cat';
      const x = (opts.x != null) ? opts.x : 80;
      const y = (opts.y != null) ? opts.y : (window.innerHeight - 140);
      cat.style.left = x + 'px';
      cat.style.top  = y + 'px';
      cat._anim = animations[opts.anim || 'idle'];
      cat._frameIndex = 0;
      cat._lastFrameTime = performance.now();
      cat._dir = Math.random() > 0.5 ? 1 : -1;
      cat._posX = x;
      cat._posY = y;

      // Set background-size immediately so the full sheet is scaled and we only show one frame
      const sheetWidth  = FRAMES_PER_ROW * FRAME_W * CAT_SCALE;
      const sheetHeight = SHEET_ROWS * FRAME_H * CAT_SCALE;
      cat.style.backgroundSize = sheetWidth + 'px ' + sheetHeight + 'px';

      // initial background-position (one frame)
      const px0 = -cat._frameIndex * FRAME_W * CAT_SCALE;
      const py0 = -cat._anim.row * FRAME_H * CAT_SCALE;
      cat.style.backgroundPosition = px0 + 'px ' + py0 + 'px';

      // initial flip
      cat.style.transform = `scaleX(${cat._dir})`;

      document.body.appendChild(cat);

      function updateFrame(now){
        const a = cat._anim;
        if (!a) return;
        if (now - cat._lastFrameTime > a.speed) {
          cat._frameIndex = (cat._frameIndex + 1) % a.frames;
          cat._lastFrameTime = now;
          const px = -cat._frameIndex * FRAME_W * CAT_SCALE;
          const py = -a.row * FRAME_H * CAT_SCALE;
          cat.style.backgroundPosition = px + 'px ' + py + 'px';
        }
      }

      function tick(now){
        // Reaction to mouse: cats move horizontally away from mouseX
        const dx = (cat._posX + (FRAME_W*CAT_SCALE)/2) - mouseX; // positive if cat is right of mouse
        const dist = Math.abs(dx);
        // determine behaviour: if close, run; if mid, walk; else idle
        if (dist < 120) cat._anim = animations.run;
        else if (dist < 320) cat._anim = animations.walk;
        else cat._anim = animations.idle;

        // Direction: move away horizontally only
        if (dist > 40) {
          const dirAway = dx > 0 ? 1 : -1; // if cat is right of mouse, dirAway=1 (move right)
          // speed scales with animation move and closeness
          const speedFactor = clamp((180 - dist) / 180, 0.1, 1.0); // closer => faster (for run)
          const baseMove = cat._anim.move;
          const delta = baseMove * (1 + (1 - speedFactor)) * (dirAway); // move away
          cat._posX += delta;
          // keep within bounds horizontally
          const minX = 6;
          const maxX = window.innerWidth - FRAME_W * CAT_SCALE - 6;
          if (cat._posX < minX) cat._posX = minX;
          if (cat._posX > maxX) cat._posX = maxX;
          // set flip according to movement direction (face away from mouse)
          const facing = dirAway > 0 ? 1 : -1;
          cat.style.transform = `scaleX(${facing})`;
        }

        cat.style.left = Math.round(cat._posX) + 'px';
        // keep vertical fixed (no up/down)
        cat.style.top = Math.round(cat._posY) + 'px';

        updateFrame(now);
        cat._raf = requestAnimationFrame(tick);
      }
      cat._raf = requestAnimationFrame(tick);

      cat.destroy = () => {
        cancelAnimationFrame(cat._raf);
        if (cat.parentNode) cat.parentNode.removeChild(cat);
      };
      return cat;
    }

    /* ================= LOGIQUE UI ================= */
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const toast  = document.getElementById('toast');
    let noClicks = 0;
    let noEscaped = false;
    const createdCats = [];

    function showToast(msg, t = 1400){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toast._timeout);
      toast._timeout = setTimeout(()=> toast.classList.remove('show'), t);
    }

    // Bouton "Non" : fuite smooth et rapide
    noBtn.addEventListener('click', () => {
      if (noEscaped) return;
      noClicks++;
      const msgs = ["Tu es sÃ»re ?", "Vraiment ?", "Oh... d'accord, attends..."];
      showToast(msgs[Math.min(msgs.length-1, noClicks-1)]);
      const scale = Math.max(0.45, 1 - noClicks * 0.22);
      noBtn.style.transform = `scale(${scale})`;
      noBtn.style.transition = 'transform 200ms cubic-bezier(.2,.9,.3,1)';

      if (noClicks >= 3) {
        noEscaped = true;

        const rect = noBtn.getBoundingClientRect();
        const startX = rect.left;
        const endX = window.innerWidth + 200;
        const duration = 420;
        const easing = t => 1 - Math.pow(1 - t, 3);
        const start = performance.now();

        noBtn.style.position = 'fixed';
        noBtn.style.top = rect.top + 'px';
        noBtn.style.left = startX + 'px';
        noBtn.style.zIndex = 9999;
        noBtn.style.pointerEvents = 'none';

        function animate(now){
          const p = clamp((now - start) / duration, 0, 1);
          const e = easing(p);
          const cur = startX + (endX - startX) * e;
          noBtn.style.left = cur + 'px';
          noBtn.style.transform = `translateZ(0) rotate(${e * 18}deg) scale(0.85)`;
          if (p < 1) requestAnimationFrame(animate);
          else spawnCatsAfterEscape();
        }
        requestAnimationFrame(animate);
      }
    });

    yesBtn.addEventListener('click', () => {
      showToast("Oui ! ðŸ’ž", 1200);
      yesBtn.disabled = true;
      yesBtn.style.opacity = 0.85;
    });

    function spawnCatsAfterEscape(){
      const w = window.innerWidth;
      const h = window.innerHeight;
      const baseY = Math.max(120, h - (FRAME_H * CAT_SCALE) - 40);
      const N = 5;
      for (let i=0;i<N;i++){
        const x = Math.floor(40 + Math.random() * (Math.max(200, w - 160)));
        const y = baseY - Math.floor(Math.random() * 20);
        const anim = Math.random() > 0.5 ? 'walk' : 'idle';
        const cat = createCat({ x, y, anim });
        // randomize initial frame so they don't animate in sync
        cat._frameIndex = Math.floor(Math.random() * (cat._anim.frames || 4));
        createdCats.push(cat);
      }
      showToast("Ils sont lÃ ... ðŸ¾", 1400);
    }

    // Clean up
    window.addEventListener('beforeunload', () => {
      createdCats.forEach(c => c.destroy && c.destroy());
    });

    // debug helper (dÃ©commenter pour forcer l'apparition)
    // spawnCatsAfterEscape();

    // On resize, clamp mice and cat positions
    window.addEventListener('resize', () => {
      mouseX = clamp(mouseX, 0, window.innerWidth);
    });
  </script>
</body>
</html>
