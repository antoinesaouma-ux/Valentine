<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Veux-tu Ãªtre ma Valentine ? ğŸ’•</title>
  <!--
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  CARTE INTERACTIVE "VALENTINE" AVEC CHATS ANIMÃ‰S                          â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘  COMPORTEMENTS PRINCIPAUX :                                               â•‘
    â•‘  â€¢ Carte carrÃ©e centrÃ©e avec 2 lignes romantiques inspirÃ©es de Cyrano     â•‘
    â•‘  â€¢ Boutons Oui/Non : "Oui" â†’ confirmation ; "Non" â†’ compteur              â•‘
    â•‘  â€¢ Au 3áµ‰ clic sur "Non" : spawn de chats animÃ©s par sprite-sheet         â•‘
    â•‘  â€¢ Chats : animation ping-pong, fuite de la souris (axe X uniquement)     â•‘
    â•‘  â€¢ AprÃ¨s 3 survols d'un chat : il part hors Ã©cran en marchant             â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘  MODIFICATIONS RAPIDES :                                                  â•‘
    â•‘  â†’ Section CONFIG (ligne ~80) : chemins, dimensions sprite, vitesses      â•‘
    â•‘  â†’ Section CSS :root (ligne ~40) : couleurs, tailles, Ã©chelle des chats   â•‘
    â•‘  â†’ Chemin sprite par dÃ©faut : images/cat.png                              â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  -->
  <style>
    /* ========================================================================
       VARIABLES CSS GLOBALES (modifiables facilement)
       ======================================================================== */
    :root {
      --card-size: min(90vmin, 600px); /* Carte carrÃ©e responsive */
      --card-bg: linear-gradient(135deg, #ffeef8 0%, #ffe0f0 100%);
      --card-shadow: 0 20px 60px rgba(255, 105, 180, 0.3);
      --text-color: #d63384;
      --btn-yes-bg: #28a745;
      --btn-yes-hover: #218838;
      --btn-no-bg: #dc3545;
      --btn-no-hover: #c82333;
      --font-romantic: 'Georgia', 'Palatino', serif;
    }

    /* Reset & Body */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-romantic);
      background: linear-gradient(to bottom, #fff5f7, #ffe4e9);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden; /* EmpÃªche scroll lors du mouvement des chats */
      position: relative;
    }

    /* ========================================================================
       CARTE CARRÃ‰E CENTRALE
       ======================================================================== */
    .card {
      width: var(--card-size);
      height: var(--card-size);
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      text-align: center;
      position: relative;
      z-index: 10; /* Au-dessus des chats */
      border: 3px solid rgba(255, 182, 193, 0.6);
    }

    /* Texte romantique inspirÃ© de Cyrano */
    .romantic-text {
      font-size: clamp(1rem, 2.5vmin, 1.4rem);
      line-height: 1.6;
      color: var(--text-color);
      font-style: italic;
      margin-bottom: 1.5rem;
      max-width: 80%;
    }

    .romantic-text p {
      margin-bottom: 1rem;
    }

    .romantic-text .question {
      font-weight: bold;
      font-size: clamp(1.2rem, 3vmin, 1.8rem);
      font-style: normal;
      margin-top: 1.5rem;
      color: #c2185b;
    }

    /* ========================================================================
       BOUTONS OUI / NON
       ======================================================================== */
    .buttons {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
    }

    button {
      padding: 1rem 2.5rem;
      font-size: clamp(1rem, 2.5vmin, 1.3rem);
      font-family: var(--font-romantic);
      font-weight: bold;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    button:focus {
      outline: 3px solid rgba(255, 255, 255, 0.8);
      outline-offset: 4px;
    }

    #btnYes {
      background: var(--btn-yes-bg);
    }

    #btnYes:hover {
      background: var(--btn-yes-hover);
      transform: scale(1.1) rotate(-2deg);
    }

    #btnNo {
      background: var(--btn-no-bg);
    }

    #btnNo:hover {
      background: var(--btn-no-hover);
      transform: scale(1.05);
    }

    /* Message de confirmation (Ã©tat "Oui" cliquÃ©) */
    .confirmation {
      display: none;
      font-size: clamp(1.5rem, 4vmin, 2.5rem);
      color: #28a745;
      font-weight: bold;
      animation: heartbeat 1s infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* Compteur de clics "Non" (facultatif visuel) */
    #noCounter {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(220, 53, 69, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 0.9rem;
      color: var(--text-color);
      display: none; /* Devient visible aprÃ¨s 1er clic "Non" */
    }

    /* ========================================================================
       CHATS ANIMÃ‰S (sprite-sheet)
       ======================================================================== */
    .cat {
      position: fixed;
      /* Dimensions calculÃ©es dynamiquement via CAT_SCALE Ã— FRAME_W/H */
      width: calc(64px * 1.5); /* Valeur par dÃ©faut, sera mise Ã  jour par JS */
      height: calc(64px * 1.5);
      background-image: url('images/cat.png'); /* â† CHEMIN PAR DÃ‰FAUT */
      background-repeat: no-repeat;
      background-size: calc(8 * 64px * 1.5) auto; /* 8 frames/row Ã— FRAME_W Ã— scale */
      image-rendering: pixelated; /* Style pixel-art si appropriÃ© */
      pointer-events: auto;
      z-index: 5; /* Sous la carte */
      transition: none; /* Pas de transition CSS, animÃ© via JS */
    }

    /* Flip horizontal pour direction gauche */
    .cat.face-left {
      transform: scaleX(-1);
    }

    .cat.face-right {
      transform: scaleX(1);
    }
  </style>
</head>
<body>

  <!-- ========================================================================
       CARTE PRINCIPALE
       ======================================================================== -->
  <div class="card" id="card">
    <div class="romantic-text">
      <p>
        Â« Je t'aime non pour ce que tu es,<br>
        mais pour ce que je suis quand je suis avec toi. Â»
      </p>
      <p class="question">
        Veuxâ€‘tu Ãªtre ma Valentine ? ğŸ’•
      </p>
    </div>

    <div class="buttons" id="buttons">
      <button id="btnYes">Oui â¤ï¸</button>
      <button id="btnNo">Non</button>
    </div>

    <div class="confirmation" id="confirmation">
      Oui ! â¤ï¸âœ¨
    </div>

    <div id="noCounter"></div>
  </div>

  <!-- ========================================================================
       SCRIPT PRINCIPAL
       ======================================================================== -->
  <script>
    'use strict';

    /* ========================================================================
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆâ–ˆ                      SECTION CONFIG                            â–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆâ–ˆ  â†’ MODIFIE ICI tous les paramÃ¨tres (sprite, tailles, vitesses) â–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
       ======================================================================== */

    const CONFIG = {
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // SPRITE-SHEET (chemin et dimensions)
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CAT_SRC: 'images/cat.png',        // â† Chemin vers la sprite-sheet
      FRAME_W: 64,                      // Largeur d'une frame (px)
      FRAME_H: 64,                      // Hauteur d'une frame (px)
      FRAMES_PER_ROW: 8,                // Nombre de frames par ligne
      TOTAL_FRAMES: 16,                 // Nombre total de frames dans la sheet
      FPS: 10,                          // Images par seconde de l'animation
      PINGPONG: true,                   // true = aller/retour ; false = boucle simple

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // AFFICHAGE & Ã‰CHELLE
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CAT_SCALE: 1.5,                   // Multiplie FRAME_W/H pour taille affichÃ©e

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // COMPORTEMENT : FUITE DE LA SOURIS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      FEAR_RADIUS: 160,                 // Distance (px X) Ã  partir de laquelle le chat fuit
      FLEE_SPEED: 3.0,                  // Vitesse de fuite (px/frame)
      WALK_SPEED: 1.1,                  // Vitesse de marche normale (ping-pong)
      PANIC_SPEED: 4.0,                 // Vitesse max en panique (si besoin)

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // SORTIE D'Ã‰CRAN & RESPAWN
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      OFFSCREEN_MARGIN: 200,            // Marge hors Ã©cran avant suppression
      HOVER_THRESHOLD: 3,               // Nb de survols avant qu'un chat "parte"

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // DÃ‰CLENCHEUR : SPAWN DES CHATS APRÃˆS 3 CLICS SUR "NON"
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      NO_CLICKS_TO_SPAWN: 3,            // Nb de clics sur "Non" avant spawn
    };

    /* ========================================================================
       VARIABLES GLOBALES
       ======================================================================== */
    let cats = [];                      // Tableau des chats spawned
    let mouseX = -9999, mouseY = -9999; // Position souris (initialisÃ©e hors Ã©cran)
    let animationFrameId = null;        // ID de requestAnimationFrame
    let noClickCount = 0;               // Compteur clics sur "Non"
    let catsSpawned = false;            // Flag : les chats sont-ils apparus ?

    // RÃ©fÃ©rences DOM
    const btnYes = document.getElementById('btnYes');
    const btnNo = document.getElementById('btnNo');
    const buttons = document.getElementById('buttons');
    const confirmation = document.getElementById('confirmation');
    const noCounter = document.getElementById('noCounter');
    const card = document.getElementById('card');

    /* ========================================================================
       INITIALISATION : Ã‰COUTEURS & SPRITE PRELOAD
       ======================================================================== */
    function init() {
      // Preload sprite-sheet
      const img = new Image();
      img.src = CONFIG.CAT_SRC;
      img.onload = () => {
        console.log(`âœ… Sprite-sheet chargÃ©e : ${CONFIG.CAT_SRC}`);
      };
      img.onerror = () => {
        console.error(`âŒ ERREUR : impossible de charger ${CONFIG.CAT_SRC}`);
        alert(`âš ï¸ Sprite manquante !\nPlace ton fichier dans : ${CONFIG.CAT_SRC}`);
      };

      // Bouton "Oui" : afficher confirmation et stopper interactions
      btnYes.addEventListener('click', () => {
        buttons.style.display = 'none';
        confirmation.style.display = 'block';
        noCounter.style.display = 'none';
        // Optionnel : arrÃªter animation des chats
        if (animationFrameId) cancelAnimationFrame(animationFrameId);
        // Retirer les chats du DOM
        cats.forEach(cat => cat.el.remove());
        cats = [];
      });

      // Bouton "Non" : incrÃ©menter compteur, spawn au 3áµ‰ clic
      btnNo.addEventListener('click', () => {
        noClickCount++;
        noCounter.textContent = `"Non" cliquÃ© : ${noClickCount} fois`;
        noCounter.style.display = 'block';

        if (noClickCount >= CONFIG.NO_CLICKS_TO_SPAWN && !catsSpawned) {
          catsSpawned = true;
          console.log(`ğŸ± Spawn des chats aprÃ¨s ${CONFIG.NO_CLICKS_TO_SPAWN} clics "Non"`);
          spawnCats();
          startAnimation();
        }
      });

      // Tracking souris (global)
      document.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
      });
    }

    /* ========================================================================
       SPAWN DES CHATS (3 lignes : haut, milieu, bas)
       ======================================================================== */
    function spawnCats() {
      const screenW = window.innerWidth;
      const screenH = window.innerHeight;
      const catW = CONFIG.FRAME_W * CONFIG.CAT_SCALE;
      const catH = CONFIG.FRAME_H * CONFIG.CAT_SCALE;

      // Lignes Y fixes (haut = 20%, milieu = 50%, bas = 80%)
      const yTop = screenH * 0.2;
      const yMid = screenH * 0.5;
      const yBot = screenH * 0.8;

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // CHATS FIXES (haut et bas) : ne bougent pas, ne fuient pas
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cats.push(createCat(screenW * 0.15, yTop, 'fixed', 'right'));
      cats.push(createCat(screenW * 0.85, yTop, 'fixed', 'left'));
      cats.push(createCat(screenW * 0.25, yBot, 'fixed', 'right'));
      cats.push(createCat(screenW * 0.75, yBot, 'fixed', 'left'));

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // CHATS MOBILES (milieu) : ping-pong horizontal, fuient la souris
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cats.push(createCat(screenW * 0.3, yMid, 'mobile', 'right'));
      cats.push(createCat(screenW * 0.7, yMid, 'mobile', 'left'));
    }

    /* ========================================================================
       CRÃ‰ATION D'UN CHAT (objet + Ã©lÃ©ment DOM)
       ======================================================================== */
    function createCat(x, y, type, facing) {
      const el = document.createElement('div');
      el.className = 'cat';
      el.style.width = `${CONFIG.FRAME_W * CONFIG.CAT_SCALE}px`;
      el.style.height = `${CONFIG.FRAME_H * CONFIG.CAT_SCALE}px`;
      el.style.backgroundSize = `${CONFIG.FRAMES_PER_ROW * CONFIG.FRAME_W * CONFIG.CAT_SCALE}px auto`;
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
      document.body.appendChild(el);

      const cat = {
        el,                         // Element DOM
        x, y,                       // Position
        vx: 0,                      // VÃ©locitÃ© X (mouvement)
        type,                       // 'fixed' ou 'mobile'
        facing,                     // 'left' ou 'right'
        frame: 0,                   // Frame actuelle (0..TOTAL_FRAMES-1)
        frameTimer: 0,              // Timer pour FPS
        direction: 1,               // +1 (forward) ou -1 (backward) pour ping-pong
        hoverCount: 0,              // Nb de survols (mouseenter)
        leaving: false,             // true = en train de partir hors Ã©cran
        markedForRemoval: false,    // true = Ã  supprimer du tableau
      };

      // Initialiser direction pour mobiles
      if (type === 'mobile') {
        cat.vx = (facing === 'right') ? CONFIG.WALK_SPEED : -CONFIG.WALK_SPEED;
      }

      // Ã‰vÃ©nement mouseenter : incrÃ©menter hoverCount
      el.addEventListener('mouseenter', () => {
        if (cat.type === 'mobile' && !cat.leaving) {
          cat.hoverCount++;
          console.log(`ğŸ± Chat survolÃ© ${cat.hoverCount}/${CONFIG.HOVER_THRESHOLD}`);
          if (cat.hoverCount >= CONFIG.HOVER_THRESHOLD) {
            cat.leaving = true;
            console.log('ğŸ± Chat part hors Ã©cran !');
            // Choisir direction de sortie (vers bord le plus proche)
            cat.vx = (cat.x < window.innerWidth / 2) ? -CONFIG.PANIC_SPEED : CONFIG.PANIC_SPEED;
            cat.facing = (cat.vx > 0) ? 'right' : 'left';
            setFacing(cat);
          }
        }
      });

      setFacing(cat);
      applyFrame(cat);

      return cat;
    }

    /* ========================================================================
       ANIMATION PRINCIPALE (requestAnimationFrame)
       ======================================================================== */
    function startAnimation() {
      const frameDelay = 1000 / CONFIG.FPS;

      function loop(timestamp) {
        cats.forEach(cat => {
          if (cat.markedForRemoval) return;

          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          // 1) COMPORTEMENT : fixed vs mobile vs leaving
          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          if (cat.type === 'fixed') {
            // Aucun mouvement, juste animation sur place
          } else if (cat.leaving) {
            // Part hors Ã©cran en ligne droite
            cat.x += cat.vx;
            // VÃ©rifier si hors Ã©cran
            const margin = CONFIG.OFFSCREEN_MARGIN;
            if (cat.x < -margin || cat.x > window.innerWidth + margin) {
              cat.markedForRemoval = true;
              cat.el.remove();
              console.log('ğŸ± Chat supprimÃ© (hors Ã©cran)');
              return;
            }
          } else {
            // Mobile : fuite souris OU ping-pong
            const distX = Math.abs(mouseX - cat.x);
            if (distX < CONFIG.FEAR_RADIUS) {
              // FUITE : s'Ã©loigner de la souris (axe X uniquement)
              const flee = (cat.x < mouseX) ? -CONFIG.FLEE_SPEED : CONFIG.FLEE_SPEED;
              cat.vx = flee;
              cat.facing = (flee > 0) ? 'right' : 'left';
              setFacing(cat);
              cat.x += cat.vx;
            } else {
              // PING-PONG : marche normale avec rebonds
              cat.x += cat.vx;
              const catW = CONFIG.FRAME_W * CONFIG.CAT_SCALE;
              if (cat.x <= 0) {
                cat.x = 0;
                cat.vx = CONFIG.WALK_SPEED;
                cat.facing = 'right';
                setFacing(cat);
              } else if (cat.x >= window.innerWidth - catW) {
                cat.x = window.innerWidth - catW;
                cat.vx = -CONFIG.WALK_SPEED;
                cat.facing = 'left';
                setFacing(cat);
              }
            }
          }

          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          // 2) MISE Ã€ JOUR POSITION DOM
          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          cat.el.style.left = `${cat.x}px`;
          cat.el.style.top = `${cat.y}px`;

          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          // 3) ANIMATION SPRITE (ping-pong frames)
          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          cat.frameTimer += 16; // ~16ms par frame (60fps)
          if (cat.frameTimer >= frameDelay) {
            cat.frameTimer = 0;
            if (CONFIG.PINGPONG) {
              cat.frame += cat.direction;
              if (cat.frame >= CONFIG.TOTAL_FRAMES - 1) {
                cat.frame = CONFIG.TOTAL_FRAMES - 1;
                cat.direction = -1; // Retour arriÃ¨re
              } else if (cat.frame <= 0) {
                cat.frame = 0;
                cat.direction = 1; // Repartir en avant
              }
            } else {
              cat.frame = (cat.frame + 1) % CONFIG.TOTAL_FRAMES;
            }
            applyFrame(cat);
          }
        });

        // Nettoyer les chats marquÃ©s pour suppression
        cats = cats.filter(c => !c.markedForRemoval);

        animationFrameId = requestAnimationFrame(loop);
      }

      animationFrameId = requestAnimationFrame(loop);
    }

    /* ========================================================================
       HELPERS : GESTION SPRITE & FACING
       ======================================================================== */

    // Appliquer la frame actuelle au background-position
    function applyFrame(cat) {
      const row = Math.floor(cat.frame / CONFIG.FRAMES_PER_ROW);
      const col = cat.frame % CONFIG.FRAMES_PER_ROW;
      const offsetX = -col * CONFIG.FRAME_W * CONFIG.CAT_SCALE;
      const offsetY = -row * CONFIG.FRAME_H * CONFIG.CAT_SCALE;
      cat.el.style.backgroundPosition = `${offsetX}px ${offsetY}px`;
    }

    // Appliquer la classe CSS pour flip horizontal (facing)
    function setFacing(cat) {
      if (cat.facing === 'left') {
        cat.el.classList.add('face-left');
        cat.el.classList.remove('face-right');
      } else {
        cat.el.classList.add('face-right');
        cat.el.classList.remove('face-left');
      }
    }

    /* ========================================================================
       DÃ‰MARRAGE
       ======================================================================== */
    init();
  </script>

</body>
</html>
