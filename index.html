<!--
===========================================================
üíå Carte Valentine Interactive avec Chats Anim√©s üê±
+ Fond anim√© : poussi√®re lumineuse + parallaxe doux üååüå†
-----------------------------------------------------------
- Fichier unique index.html
- Carte carr√©e centr√©e
- Chats invisibles avant 3 clics sur "Non"
- Sprite-sheet anim√©e ping-pong
- Fond anim√© CSS + JS (sans images)
===========================================================

MODIFICATIONS RAPIDES :
- Intensit√© parallaxe : PARALLAX_STRENGTH
- Nombre de particules : PARTICLE_COUNT
- Vitesse poussi√®re : PARTICLE_SPEED
===========================================================
-->

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ma Valentine ‚ù§Ô∏è</title>

<style>
/* =========================================================
   ==================== FOND ANIM√â =========================
   ========================================================= */

body {
  margin: 0;
  height: 100%;
  font-family: 'Georgia', serif;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(circle at top, #ffe6f0, #ffd1dc);
  overflow: hidden;
}

/* Canvas poussi√®re */
#dust {
  position: fixed;
  inset: 0;
  z-index: -2;
}

/* Couche parallaxe */
#parallax {
  position: fixed;
  inset: -5%;
  background: radial-gradient(circle at center, rgba(255,255,255,0.25), transparent 60%);
  z-index: -1;
  transition: transform 0.15s ease-out;
}

/* ===================== CARTE ===================== */
.card {
  width: min(90vmin, 420px);
  aspect-ratio: 1 / 1;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  text-align: center;
  padding: 24px;
  position: relative;
  overflow: hidden;
}

/* ===================== TEXTE ===================== */
.card p {
  margin: 10px 0;
  font-size: 1.15rem;
}

.card p:first-child {
  font-style: italic;
}

/* ===================== BOUTONS ===================== */
.buttons {
  margin-top: 20px;
}

button {
  padding: 10px 22px;
  margin: 0 10px;
  font-size: 1rem;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  background: #ff6b81;
  color: #fff;
}

button.no {
  background: #aaa;
}

button:focus {
  outline: 3px solid #000;
}

/* ===================== CONFIRMATION ===================== */
.confirmation {
  font-size: 1.6rem;
  margin-top: 30px;
  color: #ff3366;
}

/* ===================== CHATS ===================== */
.cat {
  position: absolute;
  width: calc(var(--fw) * var(--scale));
  height: calc(var(--fh) * var(--scale));
  background-image: url('images/cat.png'); /* ‚ö†Ô∏è sprite ici */
  background-repeat: no-repeat;
  image-rendering: pixelated;
  pointer-events: auto;
}
</style>
</head>

<body>

<canvas id="dust"></canvas>
<div id="parallax"></div>

<div class="card" id="card">
  <p>Je t‚Äôaime non pour ce que tu es, mais pour ce que je suis quand je suis avec toi.</p>
  <p><strong>Veux-tu √™tre ma Valentine ?</strong></p>

  <div class="buttons" id="buttons">
    <button id="yesBtn">Oui</button>
    <button id="noBtn" class="no">Non</button>
  </div>
</div>

<script>
/* =========================================================
   ======================= CONFIG ==========================
   ========================================================= */
const CAT_SRC = 'images/cat.png';
const FRAME_W = 64;
const FRAME_H = 64;
const FRAMES_PER_ROW = 8;
const TOTAL_FRAMES = 16;
const FPS = 10;
const CAT_SCALE = 1.5;

const FEAR_RADIUS = 160;
const WALK_SPEED = 1.1;
const FLEE_SPEED = 3.0;
const PANIC_SPEED = 4.0;

const HOVER_THRESHOLD = 3;
const HOVER_NO_SPAWN_THRESHOLD = 3;

/* Fond anim√© */
const PARTICLE_COUNT = 90;      // quantit√© de poussi√®re
const PARTICLE_SPEED = 0.15;    // vitesse verticale
const PARALLAX_STRENGTH = 18;   // intensit√© parallaxe

/* ========================================================= */

document.documentElement.style.setProperty('--fw', FRAME_W + 'px');
document.documentElement.style.setProperty('--fh', FRAME_H + 'px');
document.documentElement.style.setProperty('--scale', CAT_SCALE);

const card = document.getElementById('card');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const buttons = document.getElementById('buttons');

let noCount = 0;
let catsSpawned = false;
let mouseX = 0;

window.addEventListener('mousemove', e => mouseX = e.clientX);

/* ===================== PARALLAX ===================== */
const parallax = document.getElementById('parallax');
window.addEventListener('mousemove', e => {
  const x = (e.clientX / window.innerWidth - 0.5) * PARALLAX_STRENGTH;
  const y = (e.clientY / window.innerHeight - 0.5) * PARALLAX_STRENGTH;
  parallax.style.transform = `translate(${x}px, ${y}px)`;
});

/* ===================== OUI / NON ===================== */
yesBtn.onclick = () => {
  buttons.remove();
  const msg = document.createElement('div');
  msg.className = 'confirmation';
  msg.textContent = 'Oui ! ‚ù§Ô∏è';
  card.appendChild(msg);
};

noBtn.onclick = () => {
  noCount++;
  if (noCount >= HOVER_NO_SPAWN_THRESHOLD && !catsSpawned) {
    spawnCats();
    catsSpawned = true;
  }
};

/* ===================== CHATS ===================== */
const cats = [];

function spawnCats() {
  ['20%', '50%', '80%'].forEach((top, i) => {
    const el = document.createElement('div');
    el.className = 'cat';
    el.style.top = top;
    el.style.left = '20px';

    const c = {
      el,
      x: 20,
      vx: WALK_SPEED,
      frame: 0,
      dir: 1,
      hover: 0,
      mobile: i === 1
    };

    el.addEventListener('mouseenter', () => {
      c.hover++;
      if (c.hover >= HOVER_THRESHOLD) c.vx = PANIC_SPEED * c.dir;
    });

    card.appendChild(el);
    cats.push(c);
  });

  requestAnimationFrame(loop);
}

let last = 0;
function loop(ts) {
  if (ts - last > 1000 / FPS) {
    cats.forEach(c => {
      if (c.mobile) {
        const d = Math.abs(mouseX - (card.offsetLeft + c.x));
        c.vx = d < FEAR_RADIUS
          ? (mouseX < card.offsetLeft + c.x ? FLEE_SPEED : -FLEE_SPEED)
          : c.dir * WALK_SPEED;
        c.x += c.vx;
      }

      if (c.x < 0 || c.x > card.clientWidth - FRAME_W * CAT_SCALE) {
        c.dir *= -1;
        c.vx *= -1;
      }

      c.el.style.left = c.x + 'px';

      c.frame += c.dir;
      if (c.frame >= TOTAL_FRAMES || c.frame < 0) c.dir *= -1;

      const fx = (c.frame % FRAMES_PER_ROW) * FRAME_W;
      const fy = Math.floor(c.frame / FRAMES_PER_ROW) * FRAME_H;
      c.el.style.backgroundPosition = `-${fx}px -${fy}px`;
      c.el.style.transform = c.vx < 0 ? 'scaleX(-1)' : 'scaleX(1)';
    });
    last = ts;
  }
  requestAnimationFrame(loop);
}

/* ===================== POUSSI√àRE LUMINEUSE ===================== */
const canvas = document.getElementById('dust');
const ctx = canvas.getContext('2d');
let w, h, particles = [];

function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

for (let i = 0; i < PARTICLE_COUNT; i++) {
  particles.push({
    x: Math.random() * w,
    y: Math.random() * h,
    r: Math.random() * 1.8 + 0.5,
    a: Math.random() * Math.PI * 2
  });
}

function dustLoop() {
  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = 'rgba(255,255,255,0.6)';

  particles.forEach(p => {
    p.y -= PARTICLE_SPEED;
    p.x += Math.sin(p.a) * 0.2;
    if (p.y < 0) p.y = h;

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
    ctx.fill();
  });

  requestAnimationFrame(dustLoop);
}
dustLoop();
</script>

</body>
</html>
