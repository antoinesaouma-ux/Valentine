<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat ‚Äî interaction</title>
  <style>
    :root{
      --scale: 4;
      --accent: #7c5cff;
      --bg: #0f1020;
      --glass: rgba(255,255,255,0.04);
    }
    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      overflow:hidden;
      font-family:Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      color: #e8e8f0;
    }

/* --- Pixel cat sprite --- */
.cat{
  position:absolute;
  width: var(--frame-w,32px);
  height: var(--frame-h,32px);
  background-image: url("image/cat.png"); /* <-- adapte le chemin si besoin */
  background-repeat: no-repeat;
  image-rendering: pixelated;
  transform-origin: center;
  will-change: left, top, background-position, transform;
  pointer-events:none;
}

/* --- Overlay UI --- */
.overlay {
  position: absolute;
  inset: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}
.card {
  pointer-events: auto;
  width: min(720px, 92%);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 14px;
  padding: 22px;
  box-shadow: 0 6px 30px rgba(0,0,0,0.6);
  border: 1px solid rgba(255,255,255,0.04);
  display: grid;
  gap: 12px;
  grid-template-columns: 1fr auto;
  align-items: center;
}
.card h1{ margin:0; font-size:18px; }
.card p{ margin:0; color:#bfc0d9; font-size:13px; }

.controls { display:flex; gap:12px; align-items:center; }

.btn {
  height:44px;
  padding: 0 16px;
  border-radius: 10px;
  font-weight:600;
  background:var(--glass);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.05);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  transition: transform 220ms cubic-bezier(.2,.9,.3,1), opacity 220ms, left 800ms ease;
  user-select:none;
  position:relative;
}
.btn.primary {
  background: linear-gradient(90deg, var(--accent), #5be3ff);
  color: #061223;
  border: none;
  box-shadow: 0 6px 18px rgba(124,92,255,0.18);
}
.btn.secondary { background: transparent; border: 1px solid rgba(255,255,255,0.06); }

.toast {
  grid-column: 1 / -1;
  color: #d6d7ff;
  font-size:13px;
  opacity:0;
  transform: translateY(6px);
  transition: opacity 220ms, transform 220ms;
  pointer-events:none;
}
.toast.show { opacity:1; transform: translateY(0); }

.note {
  position: absolute;
  left: 18px;
  bottom: 18px;
  color: rgba(255,255,255,0.28);
  font-size:12px;
}

@media (max-width:520px){
  .card{ padding:14px; grid-template-columns:1fr; gap:10px; }
  .controls{ justify-content:flex-end; }
}
  </style>
</head>
<body>

  <!-- Overlay question -->
  <div class="overlay" id="overlay">
    <div class="card" role="dialog" aria-modal="true" aria-label="Question">
      <div>
        <h1>Veux-tu adopter un chat ? üê±</h1>
        <p>Ils sont mignons, joueurs et parfois taquins. Clique :</p>
      </div>

  <div class="controls">
    <button id="yesBtn" class="btn primary">Oui</button>
    <button id="noBtn" class="btn secondary">Non</button>
  </div>

  <div class="toast" id="toast">Oh vraiment ?</div>
</div>
  </div>

  <div class="note">Astuce : bouge la souris pour voir les chats r√©agir.</div>

  <script>
    /* ===========================
       R√âGLAGES
       =========================== */
    const FRAME_W = 32;
    const FRAME_H = 32;
    const FRAMES_PER_ROW = 8;
    document.documentElement.style.setProperty('--frame-w', FRAME_W + 'px');
    document.documentElement.style.setProperty('--frame-h', FRAME_H + 'px');

    const animations = {
      idle: { row: 7, frames: 4, speed: 500, move: 0 },
      walk: { row: 4, frames: FRAMES_PER_ROW, speed: 120, move: 1.2 },
      run:  { row: 5, frames: FRAMES_PER_ROW, speed: 80,  move: 2.6 }
    };

    function getAnimSafe(name){
      const a = animations[name];
      if (!a) return animations.idle;
      return a;
    }

    function clamp(v, a, b){ return Math.min(Math.max(v, a), b); }

    /* ===========================
       createCat
       =========================== */
    function createCat(opts = {}) {
      const startX = opts.x ?? 120;
      const startY = opts.y ?? 220;
      let state = opts.anim ?? 'idle';
      const cat = document.createElement('div');
      cat.className = 'cat';
      cat.style.left = startX + 'px';
      cat.style.top = startY + 'px';
      document.body.appendChild(cat);

      let posX = startX;
      let lastFrameChange = performance.now();
      let frameIndex = 0;
      let lastTick = performance.now();
      let currentAnim = getAnimSafe(state);

      let mouseX = window.innerWidth / 2;
      window.addEventListener('mousemove', e => mouseX = e.clientX);

      function setState(name){
        currentAnim = getAnimSafe(name);
        frameIndex = 0;
        lastFrameChange = performance.now();
      }

      function updateFrame(now){
        if (now - lastFrameChange >= currentAnim.speed) {
          frameIndex = (frameIndex + 1) % Math.max(1, currentAnim.frames);
          lastFrameChange = now;
          const bgX = -frameIndex * FRAME_W;
          const bgY = -currentAnim.row * FRAME_H;
          cat.style.backgroundPosition = `${bgX}px ${bgY}px`;
        }
      }

      function tick(now){
        const dt = Math.min(60, now - lastTick);
        lastTick = now;

        const centerX = posX + FRAME_W/2;
        const d = Math.abs(centerX - mouseX);

        if (d < 120) {
          setState('run');
        } else if (d < 280) {
          setState('walk');
        } else {
          setState('idle');
        }

        const dirToMouse = centerX - mouseX;
        if (currentAnim.move > 0) {
          if (Math.abs(dirToMouse) < 420) {
            if (dirToMouse < 0) {
              posX -= currentAnim.move;
              cat.style.transform = `scale(var(--scale,4)) scaleX(-1)`;
            } else {
              posX += currentAnim.move;
              cat.style.transform = `scale(var(--scale,4)) scaleX(1)`;
            }
          }
        } else {
          cat.style.transform = `scale(var(--scale,4))`;
        }

        // nudge back (correction douce si sortie)
        const OUT_LEFT = -FRAME_W * 0.5;
        const OUT_RIGHT = window.innerWidth - FRAME_W + FRAME_W * 0.5;

        if (posX < OUT_LEFT) {
          posX += Math.max(0.5, (OUT_LEFT - posX) * 0.12);
        } else if (posX > OUT_RIGHT) {
          posX -= Math.max(0.5, (posX - OUT_RIGHT) * 0.12);
        }

        posX = clamp(posX, -FRAME_W, window.innerWidth - FRAME_W + FRAME_W);

        cat.style.left = Math.round(posX) + 'px';
        updateFrame(now);
        requestAnimationFrame(tick);
      }

      cat.style.backgroundPosition = `0px ${-currentAnim.row * FRAME_H}px`;
      cat.style.transform = `scale(var(--scale,4))`;
      requestAnimationFrame(tick);

      return { el: cat, setState };
    }

    /* ===========================
       Cr√©ation initiale et UI
       =========================== */
    const initialCats = [
      { x: 120, y: 220, anim: 'idle' },
      { x: 420, y: 320, anim: 'walk' },
      { x: 760, y: 420, anim: 'idle' }
    ];
    const createdCats = [];
    initialCats.forEach(cfg => createdCats.push(createCat(cfg)));

    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const toast  = document.getElementById('toast');
    let noClicks = 0;
    let noEscaped = false;

    function showToast(msg, t = 1500){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toast._timeout);
      toast._timeout = setTimeout(()=> toast.classList.remove('show'), t);
    }

    noBtn.addEventListener('click', (e) => {
      if (noEscaped) return;
      noClicks++;
      showToast(["Tu es s√ªr ?", "Vraiment ?", "Bon d'accord..."][Math.min(2, noClicks-1)]);
      const scale = Math.max(0.45, 1 - noClicks * 0.22);
      noBtn.style.transform = `scale(${scale})`;
      noBtn.style.transition = 'transform 260ms cubic-bezier(.2,.9,.3,1)';

      if (noClicks >= 3) {
        noEscaped = true;
        const rect = noBtn.getBoundingClientRect();
        const startLeft = rect.left;
        const endLeft = window.innerWidth + 120;
        const duration = 900;
        const start = performance.now();

        noBtn.style.pointerEvents = 'none';

        function animateBtn(t){
          const p = Math.min(1, (t - start) / duration);
          const ease = 1 - Math.pow(1 - p, 3);
          const cur = startLeft + (endLeft - startLeft) * ease;
          noBtn.style.position = 'fixed';
          noBtn.style.left = cur + 'px';
          noBtn.style.top = rect.top + 'px';
          noBtn.style.zIndex = 9999;
          if (p < 1) requestAnimationFrame(animateBtn);
          else {
            addMoreCatsAfterEscape();
            const overlay = document.getElementById('overlay');
            if (overlay) overlay.style.pointerEvents = 'none';
          }
        }
        requestAnimationFrame(animateBtn);
      }
    });

    yesBtn.addEventListener('click', () => {
      showToast("Trop bien ! üêæ", 1200);
      yesBtn.disabled = true;
      yesBtn.style.opacity = 0.8;
    });

    function addMoreCatsAfterEscape(){
      const w = window.innerWidth;
      const h = window.innerHeight;
      for (let i=0;i<5;i++){
        const x = Math.floor(60 + Math.random() * Math.max(200, w - 120));
        const y = Math.floor(Math.max(80, h - 180 - Math.random() * 260));
        createdCats.push(createCat({ x, y, anim: Math.random() > 0.5 ? 'idle' : 'walk' }));
      }
      showToast("Ils sont arriv√©s !", 1800);
    }

    document.documentElement.style.setProperty('--scale', 4);

    window.addEventListener('resize', () => {
      // rien de critique ici
    });
  </script>
</body>
</html>
