<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veux-tu Ãªtre ma Valentine ? ðŸ’Œ</title>
  <style>
    :root{
      --card-size: min(520px, 86vw);
      --bg: #0f1020;
      --card-bg: linear-gradient(180deg,#161626 0%, #0f1120 100%);
      --accent: #ff6fa3;
      --glass: rgba(255,255,255,0.03);
      --text: #ecebf6;
      --muted: #bfc0d9;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--text); display:flex; align-items:center; justify-content:center;}
    /* Container centrÃ© */
    .stage{position:relative; width:100%; height:100vh; overflow:hidden; display:flex; align-items:center; justify-content:center; padding:24px;}
    /* Card carrÃ© */
    .card {
      width: var(--card-size);
      height: var(--card-size);
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 14px 40px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 28px;
      box-sizing: border-box;
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
      justify-content:center;
      text-align:center;
      position:relative;
      z-index: 10;
    }
    .lines { font-size:15px; color:var(--muted); line-height:1.35; max-width:86%; }
    .lines .l1{ font-weight:600; color:var(--text); font-size:17px; }
    h1 { margin: 6px 0 0 0; font-size:20px; letter-spacing:0.2px; }
    .controls { margin-top:12px; display:flex; gap:12px; align-items:center; }
    .btn {
      padding: 12px 18px;
      border-radius: 12px;
      border: none;
      cursor:pointer;
      font-weight:700;
      background:var(--glass);
      color:var(--text);
      min-width:96px;
      transition: transform 220ms cubic-bezier(.2,.9,.3,1), opacity 220ms;
    }
    .btn.primary { background: linear-gradient(90deg,#ffd1e6, #ff9cc9); color:#3b0622; box-shadow: 0 8px 20px rgba(255,110,170,0.12); }
    .btn.secondary { background: transparent; border: 1px solid rgba(255,255,255,0.06); color:var(--text); }
    .toast { position:absolute; bottom:16px; left:50%; transform:translateX(-50%); color:var(--muted); font-size:13px; opacity:0; transition:opacity 220ms, transform 220ms; pointer-events:none; }
    .toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
    .note { position:absolute; left:18px; bottom:18px; color: rgba(255,255,255,0.16); font-size:12px; z-index:9; }
    /* Pixel cats (created dynamically) */
    .cat { position: absolute; width: var(--frame-w,32px); height: var(--frame-h,32px); background-image: url("image/cat.png"); background-repeat:no-repeat; image-rendering: pixelated; pointer-events:none; transform-origin:center; will-change:left,top,background-position,transform; z-index:8; }
    @media (max-width:420px){
      .card{ padding:18px; border-radius:12px; }
      h1{ font-size:18px; }
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">

<div class="card" role="dialog" aria-label="Question">
  <div class="lines">
    <div class="l1">Depuis que tu es entrÃ©e dans ma vie, chaque instant a retrouvÃ© du goÃ»t.</div>
    <div>Ton rire chasse mon ciel le plus gris, et ton regard m'apprend le courage.</div>
  </div>

  <h1>Veuxâ€‘tu Ãªtre ma Valentine ? ðŸ’˜</h1>

  <div class="controls" id="controls">
    <button id="yesBtn" class="btn primary">Oui ðŸ’–</button>
    <button id="noBtn" class="btn secondary">Non</button>
  </div>

  <div class="toast" id="toast">Oh vraiment ?</div>
</div>

<div class="note">Astuce : bouge la souris pour voir les chats rÃ©agir (aprÃ¨s le 3áµ‰ non).</div>
  </div>

  <script>
    /* ============= RÃ‰GLAGES ============= */
    // Sprite sheet : place ta feuille de frames ici (par dÃ©faut image/cat.png)
    // Si ton sprite se trouve ailleurs, change la propriÃ©tÃ© CSS .cat { background-image: url("..."); }
    const FRAME_W = 32, FRAME_H = 32;
    const FRAMES_PER_ROW = 8; // colonnes dans la sprite-sheet
    document.documentElement.style.setProperty('--frame-w', FRAME_W + 'px');
    document.documentElement.style.setProperty('--frame-h', FRAME_H + 'px');

    // Animations (row indices start at 0)
    const animations = {
      idle: { row: 7, frames: 4, speed: 500, move: 0 },
      walk: { row: 4, frames: FRAMES_PER_ROW, speed: 120, move: 1.0 },
      run:  { row: 5, frames: FRAMES_PER_ROW, speed: 80,  move: 2.4 }
    };

    // Utility
    const clamp = (v,a,b) => Math.max(a, Math.min(b, v));

    // Create a single cat DOM and handle simple frame cycling + horizontal movement
    function createCat(opts = {}) {
      const cat = document.createElement('div');
      cat.className = 'cat';
      cat.style.left = (opts.x || 80) + 'px';
      cat.style.top  = (opts.y || (window.innerHeight - 140)) + 'px';
      cat._anim = animations[opts.anim || 'idle'];
      cat._frameIndex = 0;
      cat._lastFrameTime = performance.now();
      cat._dir = Math.random() > 0.5 ? 1 : -1; // 1 -> right, -1 -> left
      document.body.appendChild(cat);

      function updateFrame(now){
        const a = cat._anim;
        if (!a) return;
        if (now - cat._lastFrameTime > a.speed) {
          cat._frameIndex = (cat._frameIndex + 1) % a.frames;
          cat._lastFrameTime = now;
          const px = -cat._frameIndex * FRAME_W;
          const py = -a.row * FRAME_H;
          cat.style.backgroundPosition = px + 'px ' + py + 'px';
        }
      }

      let posX = parseFloat(cat.style.left);
      function tick(now){
        // movement
        if (cat._anim.move !== 0) {
          posX += cat._anim.move * cat._dir * 0.9;
          // bounce at edges
          if (posX < 8) { posX = 8; cat._dir = 1; cat.style.transform = 'scaleX(1)'; }
          if (posX > window.innerWidth - FRAME_W - 8) { posX = window.innerWidth - FRAME_W - 8; cat._dir = -1; cat.style.transform = 'scaleX(-1)'; }
        }
        // gentle correction to keep in viewport
        posX = clamp(posX, -FRAME_W, window.innerWidth - FRAME_W);
        cat.style.left = Math.round(posX) + 'px';
        updateFrame(now);
        cat._raf = requestAnimationFrame(tick);
      }
      cat._raf = requestAnimationFrame(tick);

      // expose a destroy helper
      cat.destroy = () => {
        cancelAnimationFrame(cat._raf);
        if (cat.parentNode) cat.parentNode.removeChild(cat);
      };
      return cat;
    }

    /* ============= LOGIQUE UI ============= */
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const toast  = document.getElementById('toast');
    let noClicks = 0;
    let noEscaped = false;
    const createdCats = [];

    function showToast(msg, t = 1400){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toast._timeout);
      toast._timeout = setTimeout(()=> toast.classList.remove('show'), t);
    }

    noBtn.addEventListener('click', () => {
      if (noEscaped) return;
      noClicks++;
      const msgs = ["Tu es sÃ»re ?", "Vraiment ?", "Oh... d'accord, attends..."];
      showToast(msgs[Math.min(msgs.length-1, noClicks-1)]);
      // bouton qui rÃ©trÃ©cit
      const scale = Math.max(0.45, 1 - noClicks * 0.22);
      noBtn.style.transform = `scale(${scale})`;
      noBtn.style.transition = 'transform 260ms cubic-bezier(.2,.9,.3,1)';

      if (noClicks >= 3) {
        noEscaped = true;
        // animation d'Ã©chappement du bouton
        const rect = noBtn.getBoundingClientRect();
        const startLeft = rect.left;
        const endLeft = window.innerWidth + 160;
        const duration = 860;
        const start = performance.now();
        noBtn.style.pointerEvents = 'none';
        function animate(t){
          const p = clamp((t - start)/duration, 0, 1);
          const ease = 1 - Math.pow(1 - p, 3);
          const cur = startLeft + (endLeft - startLeft) * ease;
          noBtn.style.position = 'fixed';
          noBtn.style.left = (cur) + 'px';
          noBtn.style.top = rect.top + 'px';
          noBtn.style.zIndex = 9999;
          if (p < 1) requestAnimationFrame(animate);
          else {
            // aprÃ¨s la fuite, crÃ©er les chats (uniquement ici)
            spawnCatsAfterEscape();
            // rendre le reste du card non interactif si souhaitÃ©
            // document.querySelector('.card').style.pointerEvents = 'none';
          }
        }
        requestAnimationFrame(animate);
      }
    });

    yesBtn.addEventListener('click', () => {
      showToast("Oui ! ðŸ’ž", 1200);
      yesBtn.disabled = true;
      yesBtn.style.opacity = 0.85;
    });

    // CrÃ©e les chats uniquement aprÃ¨s le 3Ã¨me click sur "Non"
    function spawnCatsAfterEscape(){
      const w = window.innerWidth;
      const h = window.innerHeight;
      const baseY = Math.max(120, h - 160);
      // nombre de chats : change ici si tu veux
      const N = 5;
      for (let i=0;i<N;i++){
        const x = Math.floor(40 + Math.random() * (Math.max(200, w - 160)));
        const y = baseY - Math.floor(Math.random() * 40);
        const anim = Math.random() > 0.5 ? 'walk' : 'idle';
        const cat = createCat({ x, y, anim });
        // petits offsets et variations
        cat.style.top = (y + Math.floor(Math.random()*24)) + 'px';
        createdCats.push(cat);
      }
      showToast("Ils sont lÃ ... ðŸ¾", 1400);
    }

    // Optionnel : nettoyer les chats (debug)
    window.addEventListener('beforeunload', () => {
      createdCats.forEach(c => c.destroy && c.destroy());
    });

    // Si tu veux tester directement : dÃ©commenter la ligne suivante
    // spawnCatsAfterEscape();

  </script>
</body>
</html>
